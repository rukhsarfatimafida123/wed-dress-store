!function(){"use strict";var e={};function t(t){return Object.assign(e,t),e}function n(){return e}var r=Math.max,i=Date.now;function a(e){return null!=e}function o(e,t){(new Image).src=e+"?"+function(e){var t=[];for(var n in e){var r=e[n];a(r)&&t.push(n+"="+encodeURIComponent(r))}return t.join("&")}(t)}var u="thesemetrics::session",c="hash",s="history",f="utm_",p="hashchange",l="popstate",g="unload",d="pageread",h=document,m=h.body,v=window,y=navigator,b=location,w=v.screen,T=v.history,S=v.performance,x=v.sessionStorage;function E(e,t,n){(n||v).addEventListener(e,t,{capture:!0,passive:!0})}function j(e){var t=0,n=1;function i(){var i=e();t=r(t,function(e){return O(e.scrollTop+innerHeight,0)}(i)),n=r(n,function(e){return O(r(1,e.scrollHeight,innerHeight,e.clientHeight),1)}(i))}return E("load",(function(){return E("scroll",i,h)}),h),function(){i();var e=Math.floor(t/n*100);return t=0,n=1,e}}function O(e,t){return Number.isFinite(e)?e:t}function P(){try{return(new Intl.DateTimeFormat).resolvedOptions().timeZone}catch(e){}}var B=[1e7,-1e3,-4e3,-8e3,-1e11].join("");function R(){var e=v.crypto||v.msCrypto;return e?B.replace(/[018]/g,(function(t){return(+t^e.getRandomValues(new Uint8Array(1))[0]&15>>+t/4).toString(16)})):B.replace(/[018]/g,(function(e){var t=16*Math.random()|0;return(+e<2?t:3&t|8).toString(16)}))}function A(){var e=x.getItem(u);if(null!=e)return e;var t=R();return x.setItem(u,t),t}function D(){if(S){var e=S.getEntriesByType("navigation")[0];if(e&&/^(reload|back_forward)$/i.test(e.type))return!1;var t=I();return!t||t.split("/",2)[0]===b.hostname}return!0}function I(){var e=h.referrer;if(e)return e.replace(/^(https?:\/\/)/i,"").replace(/\?.*$/,"")}var M={count:0,lastByType:{}};function U(e){var t=M.lastByType[e.event];t&&t.path===e.path||function(e){var t=n();M.count+=1,M.lastByType[e.event]=e,t.debug&&console.debug(e),o(t.pixelURL,e)}(e)}function $(e,t){var r,i,a=n();return Object.assign({domain:a.domain,path:(r=a.mode,i=r===c?b.hash.substr(1).replace(/\?.*$/i,""):b.pathname,n().rewritePages.reduce((function(e,t){return t(e)}),i||"/")),event:e,version:"0.3.0",id:R(),session:a.session,hostname:location.hostname,timestamp:Date.now()},t)}function C(){var e=M.lastByType.pageview;if(e){var t=e.hostname,n=e.path;return"".concat(t).concat(n)}}function H(){var e=null==M.lastByType.pageview,t=$("pageview",{screen:w.width+"x"+w.height,viewport:v.innerWidth+"x"+v.innerHeight,touch:"ontouchstart"in v||"msMaxTouchPoints"in y&&y.msMaxTouchPoints>0,timezone:P(),https:location.href.startsWith("https"),unique:e&&D(),referrer:I()||C()});e&&Object.assign(t,function(){var e=n(),t=e.utm,r=function(e){var t={};return e.split("&").forEach((function(e){var n=e.split("=");t[n[0]]=!n[1]||decodeURIComponent(n[1])})),t}(function(e){return(e===c?b.hash.replace(/^.*?\?/,""):b.search).replace(/^\?/,"")}(e.mode)),i=function(e){return r[e]},a={source:r[t.source.find(i)],medium:r[t.medium.find(i)],campaign:r[t.campaign.find(i)]};for(var o in t.additionalKeys.forEach((function(e){a[f+e]=r[e]})),r)o.startsWith(f)&&(a[o]=r[o]);return a}()),U(t)}var N={pageread:null};function W(){if(!N.pageread){var e=(r=i(),a=0,o=0,E("visibilitychange",(function(){h.hidden?a=i():a>0&&(o+=a-i(),a=0)}),h),function(){var e=i()-r-o;return r=i(),o=0,e}),t=j((function(){return n().getScrollElement()}));N.pageread=function(){return{completion:t(),duration:e()}}}var r,a,o}function _(){if(N.pageread&&M.lastByType.pageview){var e=$(d,Object.assign(Object.assign({},N.pageread()),{path:M.lastByType.pageview.path}));e.duration>1e3&&U(e)}}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t(Object.assign({debug:!1,mode:s,domain:b.hostname,session:A(),pixelURL:"https://pixel.thesemetrics.org/default.gif",utm:Object.assign({source:["utm_source","ref","source"],medium:["utm_medium"],campaign:["utm_campaign"],additionalKeys:[]},e.utm),enabledEvents:[d],ignoreDNT:!1,ignorePages:[],rewritePages:[],getScrollElement:function(){return m}},e));n.enabledEvents.includes(d)&&W()}function q(e){return"true"===e}var k=/\{([^}?\/]+)\}/g;function F(e){var t=e.replace(/[\\^$+?.()|[\]]/g,"\\$&").replace(k,(function(e,t){return"(".concat(t.split(",").join("|"),")")})).replace(/[\*]+/g,(function(e){return 2===e.length?"([^?]*?)":"([^?/]+)"}));return new RegExp("^".concat(t,"$"))}!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L(e);var t=n();function r(){_(),H()}if(t.mode===c&&E(p,r),T){var i=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var a=e.apply(T,n);return r(),a}};T.pushState=i(T.pushState),T.replaceState=i(T.replaceState)}E(l,r),E(g,r),setTimeout(H,0)}(function(){var e=function(){if(h.currentScript&&""!==h.currentScript.tagName)return h.currentScript;var e=(new Error).stack,t=Array.from(h.querySelectorAll("script[src]"));if(e){var n=/((https?:)?(\/\/[^\/]+\/).*?):\d/i.exec(e);if(n){var r=n[1].split("/").pop();return t.find((function(e){return e.getAttribute("src").includes(r)}))}}return t.find((function(e){return e.getAttribute("src").includes("thesemetrics")}))}(),t={};if(e&&e.dataset){var n=e.dataset,r=n.base,i=n.domain,o=n.mode,u=n.debug,c=n.ignoreDNT,s=n.ignorePages,f=n.rewritePages,p=n.scrollSelector;t.debug=q(u),t.ignoreDNT=q(c),a(r)&&(t.pixelURL=function(e){e.startsWith("https://")||(e="https://"+e);e.endsWith("/default.gif")||(e+="/default.gif");return e}(r)),a(i)&&(t.domain=i),a(o)&&(t.mode=o),a(p)&&(t.getScrollElement=function(){return h.querySelector(p)||h.body}),a(f)&&(t.rewritePages=f.split(/[; ]/).map((function(e){var t=e.indexOf(":");return{search:e.substr(0,t),replace:e.substr(t+1)}})).map((function(e){var t=e.search,n=e.replace,r=F(t);return function(e){return r.test(e)?e.replace(r,n):e}}))),a(s)&&(t.ignorePages=function(e){return e.split(/[; ]/).map(F)}(s))}return t}()),v.TheseMetrics={setConfig:t,getConfig:n}}();
//# sourceMappingURL=browser.min.js.map
